<?phprequire '../config.php';$START_T = "START TRANSACTION;";$END_T = "COMMIT;";$sql = "select stock_in_id, ifnull(stock_in_quantity,0) - ifnull((select sum(tra_item_qty) from transaction_items where tra_item_sino = stock_in_id),0) + ifnull((select sum(dret_qty) from dealers_returns where dret_sino = stock_in_id),0) - ifnull((select sum(retc_qty) from returns_companies where retc_sino = stock_in_id),0) + ifnull((select sum(sp_qty) from swapped_products where sp_sino = stock_in_id),0) inventory from stock_in_item";db_connect();$rs = $db_con->query($sql);$rc = $rs->num_rows;if ($rc>0) {for ($i=0; $i<$rc; ++$i) {$rec = $rs->fetch_array();$nsql = "update stock_in_item set stock_in_inventory = " . $rec['inventory'] . " where stock_in_id = " . $rec['stock_in_id'];$db_con->query($START_T);$db_con->query($nsql);$db_con->query($END_T);}}   db_close();?>